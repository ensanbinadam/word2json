<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù…Ø­ÙˆÙ„ Word Ø¥Ù„Ù‰ JSON - Ù…ÙˆØ­Ø¯</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/mammoth/1.4.2/mammoth.browser.min.js"></script>
  <style>
  /* 
   * Ù…Ø­ÙˆÙ„ Word Ø¥Ù„Ù‰ JSON - Ù…ÙˆØ­Ø¯
   * Ù…Ù„Ù Ø§Ù„Ø£Ù†Ù…Ø§Ø· (CSS)
   */

  :root {
    --primary-color: #4CAF50;
    --primary-hover: #388E3C;
    --secondary-color: #2196F3;
    --secondary-hover: #1976D2;
    --error-color: #F44336;
    --success-color: #4CAF50;
    --warning-color: #FFC107;
    --light-bg: #f9f9f9;
    --dark-text: #333;
    --light-text: #fff;
    --border-color: #ddd;
    --shadow-color: rgba(0,0,0,0.1);
  }

  * {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
  }

  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    background-color: var(--light-bg);
    color: var(--dark-text);
    line-height: 1.6;
    padding: 20px;
  }

  .container {
    max-width: 900px;
    margin: 0 auto;
    background: #fff;
    padding: 25px;
    border-radius: 10px;
    box-shadow: 0 0 15px var(--shadow-color);
  }

  h1 {
    text-align: center;
    margin-bottom: 25px;
    color: var(--primary-color);
  }

  h2 {
    margin: 15px 0;
    color: var(--secondary-color);
  }

  /* File Upload Styling */
  .file-upload-container {
    margin: 20px 0;
    text-align: center;
  }

  .file-upload-label {
    display: inline-block;
    padding: 12px 20px;
    background-color: var(--secondary-color);
    color: var(--light-text);
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s;
  }

  .file-upload-label:hover {
    background-color: var(--secondary-hover);
  }

  .upload-icon {
    font-size: 1.5em;
    margin-left: 10px;
  }

  .file-upload-input {
    display: none;
  }

  .file-name {
    margin-top: 10px;
    font-size: 0.9em;
    color: var(--dark-text);
  }

  /* Form Controls */
  .form-group {
    margin: 15px 0;
  }

  .form-control {
    width: 100%;
    padding: 10px;
    font-size: 16px;
    border: 1px solid var(--border-color);
    border-radius: 5px;
    background-color: #fff;
  }

  /* Buttons */
  .button-group {
    display: flex;
    gap: 10px;
    margin: 20px 0;
  }

  .btn {
    flex: 1;
    padding: 12px;
    font-size: 16px;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    transition: background-color 0.3s, opacity 0.3s;
  }

  .btn:disabled {
    opacity: 0.6;
    cursor: not-allowed;
  }

  .primary {
    background-color: var(--primary-color);
    color: var(--light-text);
  }

  .primary:hover:not(:disabled) {
    background-color: var(--primary-hover);
  }

  .secondary {
    background-color: var(--secondary-color);
    color: var(--light-text);
  }

  .secondary:hover:not(:disabled) {
    background-color: var(--secondary-hover);
  }

  /* Progress Bar */
  .progress-container {
    margin: 20px 0;
  }

  .progress-bar {
    height: 20px;
    background-color: #e0e0e0;
    border-radius: 10px;
    overflow: hidden;
  }

  .progress {
    height: 100%;
    background-color: var(--primary-color);
    width: 0%;
    transition: width 0.3s;
  }

  .progress-text {
    text-align: center;
    margin-top: 5px;
    font-size: 0.9em;
  }

  .hidden {
    display: none;
  }

  /* Results Section */
  .result-container {
    margin-top: 30px;
  }

  .result-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 15px;
  }

  .question-count {
    font-weight: bold;
    color: var(--primary-color);
  }

  /* Tabs */
  .tabs {
    display: flex;
    border-bottom: 1px solid var(--border-color);
    margin-bottom: 15px;
  }

  .tab-btn {
    padding: 10px 20px;
    background: none;
    border: none;
    cursor: pointer;
    font-size: 16px;
    opacity: 0.7;
    transition: opacity 0.3s, border-bottom 0.3s;
  }

  .tab-btn.active {
    opacity: 1;
    border-bottom: 3px solid var(--primary-color);
  }

  .tab-content {
    display: none;
  }

  .tab-content.active {
    display: block;
  }

  /* JSON Output */
  .json-output {
    background-color: #f4f4f4;
    padding: 15px;
    border: 1px solid var(--border-color);
    border-radius: 5px;
    overflow-x: auto;
    font-family: 'Courier New', Courier, monospace;
    white-space: pre-wrap;
    max-height: 400px;
    overflow-y: auto;
  }

  /* Preview Section */
  .preview-container {
    max-height: 400px;
    overflow-y: auto;
  }

  .question-card {
    background-color: #f9f9f9;
    border: 1px solid var(--border-color);
    border-radius: 5px;
    padding: 15px;
    margin-bottom: 15px;
  }

  .question-text {
    font-weight: bold;
    margin-bottom: 10px;
  }

  .question-image {
    max-width: 100%;
    margin: 10px 0;
  }

  .options-list {
    list-style-type: none;
  }

  .option-item {
    padding: 8px;
    margin: 5px 0;
    border-radius: 5px;
  }

  .option-item.correct {
    background-color: rgba(76, 175, 80, 0.2);
    border-right: 3px solid var(--success-color);
  }

  .option-image {
    max-width: 100%;
    margin: 5px 0;
  }

  /* Responsive Design */
  @media (max-width: 768px) {
    .container {
      padding: 15px;
    }
    
    .button-group {
      flex-direction: column;
    }
    
    .result-header {
      flex-direction: column;
      align-items: flex-start;
    }
    
    .question-count {
      margin-top: 5px;
    }
  }

  /* Error Messages */
  .error-message {
    background-color: rgba(244, 67, 54, 0.1);
    color: var(--error-color);
    padding: 10px;
    border-radius: 5px;
    margin: 10px 0;
    border-right: 3px solid var(--error-color);
  }

  /* Success Messages */
  .success-message {
    background-color: rgba(76, 175, 80, 0.1);
    color: var(--success-color);
    padding: 10px;
    border-radius: 5px;
    margin: 10px 0;
    border-right: 3px solid var(--success-color);
  }
  </style>
</head>
<body>
  <div class="container">
    <h1>Ù…Ø­ÙˆÙ„ Word Ø¥Ù„Ù‰ JSON - Ù…ÙˆØ­Ø¯</h1>
    
    <div class="file-upload-container">
      <label for="fileInput" class="file-upload-label">
        <span class="upload-icon">ğŸ“„</span>
        <span class="upload-text">Ø§Ø®ØªØ± Ù…Ù„Ù Word</span>
      </label>
      <input type="file" id="fileInput" accept=".docx" class="file-upload-input">
      <div id="fileName" class="file-name"></div>
    </div>
    
    <div class="form-group">
      <label for="modelSelect">Ù†ÙˆØ¹ Ø§Ù„Ø¬Ø¯ÙˆÙ„:</label>
      <select id="modelSelect" class="form-control">
        <option value="auto">ØªÙ„Ù‚Ø§Ø¦ÙŠ (ÙƒØ´Ù ØªÙ„Ù‚Ø§Ø¦ÙŠ)</option>
        <option value="noNumber">Ø¨Ø¯ÙˆÙ† Ø±Ù‚Ù… Ù„Ù„Ø³Ø¤Ø§Ù„</option>
        <option value="withNumber">Ø¨Ø±Ù‚Ù… Ù„Ù„Ø³Ø¤Ø§Ù„</option>
        <option value="withTitle">Ù…Ø¹ Ø¹Ù†ÙˆØ§Ù†</option>
      </select>
    </div>
    
    <div class="button-group">
      <button id="convertBtn" class="btn primary" onclick="wordToJsonConverter.convertToJSON()">ØªØ­ÙˆÙŠÙ„ Ø¥Ù„Ù‰ JSON</button>
      <button id="downloadBtn" class="btn secondary" onclick="wordToJsonConverter.downloadJSON()" disabled>ØªØ­Ù…ÙŠÙ„ JSON</button>
    </div>
    
    <div id="progressContainer" class="progress-container hidden">
      <div class="progress-bar">
        <div id="progressBar" class="progress"></div>
      </div>
      <div id="progressText" class="progress-text">Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù…Ø¹Ø§Ù„Ø¬Ø©...</div>
    </div>
    
    <div class="result-container">
      <div class="result-header">
        <h2>Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø©:</h2>
        <p id="questionCount" class="question-count">Ù„Ù… ÙŠØªÙ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø£Ø³Ø¦Ù„Ø© Ø¨Ø¹Ø¯.</p>
      </div>
      
      <div class="tabs">
        <button id="jsonTab" class="tab-btn active" onclick="wordToJsonConverter.showTab('json')">JSON</button>
        <button id="previewTab" class="tab-btn" onclick="wordToJsonConverter.showTab('preview')">Ù…Ø¹Ø§ÙŠÙ†Ø©</button>
      </div>
      
      <div id="jsonOutput" class="tab-content active">
        <pre id="output" class="json-output">// Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ JSON Ù‡Ù†Ø§</pre>
      </div>
      
      <div id="previewOutput" class="tab-content">
        <div id="previewContainer" class="preview-container">
          <!-- Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù‡Ù†Ø§ -->
        </div>
      </div>
    </div>
  </div>

  <script>
  /**
   * Ù…Ø­ÙˆÙ„ Word Ø¥Ù„Ù‰ JSON - Ù…ÙˆØ­Ø¯
   * Ù…Ù„Ù Ø§Ù„Ø¨Ø±Ù…Ø¬Ø© (JavaScript)
   */

  // ØªØ¹Ø±ÙŠÙ ÙƒØ§Ø¦Ù† Ø§Ù„Ù…Ø­ÙˆÙ„
  const wordToJsonConverter = {
    // Ù…ØªØºÙŠØ±Ø§Øª Ø¹Ø§Ù…Ø©
    currentData: null,
    activeTab: 'json',
    
    // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
    init: function() {
      // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ÙŠ Ø§Ù„Ø£Ø­Ø¯Ø§Ø«
      document.getElementById('fileInput').addEventListener('change', this.handleFileSelect.bind(this));
      
      // ØªØ¹Ø·ÙŠÙ„ Ø²Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„ ÙÙŠ Ø§Ù„Ø¨Ø¯Ø§ÙŠØ©
      document.getElementById('downloadBtn').disabled = true;
      
      // Ø¥Ø¶Ø§ÙØ© Ù…Ø³ØªÙ…Ø¹ Ù„Ù„Ø£Ø®Ø·Ø§Ø¡ ØºÙŠØ± Ø§Ù„Ù…ØªÙˆÙ‚Ø¹Ø©
      window.addEventListener('error', this.handleGlobalError.bind(this));
      
      console.log('ØªÙ… ØªÙ‡ÙŠØ¦Ø© Ø§Ù„Ù…Ø­ÙˆÙ„ Ø¨Ù†Ø¬Ø§Ø­');
    },
    
    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„Ù
    handleFileSelect: function(event) {
      const fileInput = event.target;
      const fileName = document.getElementById('fileName');
      
      // Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
      this.resetUI();
      
      if (fileInput.files.length) {
        const file = fileInput.files[0];
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ù†ÙˆØ¹ Ø§Ù„Ù…Ù„Ù
        if (!file.name.endsWith('.docx')) {
          this.showError('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Word Ø¨Ø§Ù…ØªØ¯Ø§Ø¯ .docx ÙÙ‚Ø·.');
          fileInput.value = '';
          return;
        }
        
        // Ø¹Ø±Ø¶ Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù
        fileName.textContent = file.name;
        
        console.log(`ØªÙ… Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„Ù…Ù„Ù: ${file.name}`);
      } else {
        fileName.textContent = '';
      }
    },
    
    // ØªØ­ÙˆÙŠÙ„ Ù…Ù„Ù Word Ø¥Ù„Ù‰ JSON
    convertToJSON: function() {
      const fileInput = document.getElementById('fileInput');
      const output = document.getElementById('output');
      const questionCount = document.getElementById('questionCount');
      const modelSelect = document.getElementById('modelSelect').value;
      const progressContainer = document.getElementById('progressContainer');
      const progressBar = document.getElementById('progressBar');
      const progressText = document.getElementById('progressText');
      
      // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ù…Ù„Ù
      if (!fileInput.files.length) {
        this.showError('ÙŠØ±Ø¬Ù‰ Ø§Ø®ØªÙŠØ§Ø± Ù…Ù„Ù Word Ø£ÙˆÙ„Ø§Ù‹.');
        return;
      }
      
      // Ø¥Ø¸Ù‡Ø§Ø± Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
      progressContainer.classList.remove('hidden');
      progressBar.style.width = '10%';
      progressText.textContent = 'Ø¬Ø§Ø±ÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù...';
      
      const file = fileInput.files[0];
      const reader = new FileReader();
      
      reader.onload = (event) => {
        try {
          const arrayBuffer = event.target.result;
          
          // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
          progressBar.style.width = '30%';
          progressText.textContent = 'Ø¬Ø§Ø±ÙŠ ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø¥Ù„Ù‰ HTML...';
          
          mammoth.convertToHtml({
            arrayBuffer: arrayBuffer,
            convertImage: mammoth.images.inline(function(element) {
              return new Promise(function(resolve) {
                const src = element.readAsBase64();
                resolve("data:" + element.contentType + ";base64," + src);
              });
            })
          })
          .then((result) => {
            // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
            progressBar.style.width = '60%';
            progressText.textContent = 'Ø¬Ø§Ø±ÙŠ Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„...';
            
            const container = document.createElement("div");
            container.innerHTML = result.value;
            const tables = container.querySelectorAll("table");
            const quiz = [];
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ Ø¬Ø¯Ø§ÙˆÙ„
            if (tables.length === 0) {
              this.showError('Ù„Ù… ÙŠØªÙ… Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø£ÙŠ Ø¬Ø¯Ø§ÙˆÙ„ ÙÙŠ Ø§Ù„Ù…Ù„Ù.');
              progressContainer.classList.add('hidden');
              return;
            }
            
            // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
            progressBar.style.width = '80%';
            progressText.textContent = 'Ø¬Ø§Ø±ÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„...';
            
            // Ù…Ø¹Ø§Ù„Ø¬Ø© ÙƒÙ„ Ø¬Ø¯ÙˆÙ„
            tables.forEach((table) => {
              const data = this.processTable(table, modelSelect);
              if (data !== null) {
                quiz.push(data);
              }
            });
            
            // ØªØ­Ø¯ÙŠØ« Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
            progressBar.style.width = '100%';
            progressText.textContent = 'Ø§ÙƒØªÙ…Ù„ Ø§Ù„ØªØ­ÙˆÙŠÙ„!';
            
            // Ø­ÙØ¸ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØ¹Ø±Ø¶Ù‡Ø§
            this.currentData = JSON.stringify(quiz, null, 2);
            output.textContent = this.currentData;
            
            // ØªØ­Ø¯ÙŠØ« Ø¹Ø¯Ø¯ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
            const count = quiz.length;
            questionCount.textContent = `ØªÙ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ ${this.convertToIndicNumbers(count.toString())} Ø³Ø¤Ø§Ù„Ø§Ù‹.`;
            
            // ØªÙ…ÙƒÙŠÙ† Ø²Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„
            document.getElementById('downloadBtn').disabled = false;
            
            // Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
            this.createPreview(quiz);
            
            // Ø¥Ø®ÙØ§Ø¡ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù… Ø¨Ø¹Ø¯ ÙØªØ±Ø© Ù‚ØµÙŠØ±Ø©
            setTimeout(() => {
              progressContainer.classList.add('hidden');
            }, 1000);
            
            // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
            if (count > 0) {
              this.showSuccess(`ØªÙ… ØªØ­ÙˆÙŠÙ„ ${this.convertToIndicNumbers(count.toString())} Ø³Ø¤Ø§Ù„Ø§Ù‹ Ø¨Ù†Ø¬Ø§Ø­.`);
            } else {
              this.showWarning('Ù„Ù… ÙŠØªÙ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø£ÙŠ Ø£Ø³Ø¦Ù„Ø©. ØªØ£ÙƒØ¯ Ù…Ù† ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ ÙˆØ­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.');
            }
          })
          .catch((error) => {
            console.error("Error:", error);
            this.showError('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ù„Ù: ' + error.message);
            progressContainer.classList.add('hidden');
          });
        } catch (error) {
          console.error("Error:", error);
          this.showError('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù: ' + error.message);
          progressContainer.classList.add('hidden');
        }
      };
      
      reader.onerror = (error) => {
        console.error("FileReader Error:", error);
        this.showError('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù.');
        progressContainer.classList.add('hidden');
      };
      
      reader.readAsArrayBuffer(file);
    },
    
    // Ø¯Ø§Ù„Ø© Ù„ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø¥Ù„Ù‰ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù‡Ù†Ø¯ÙŠØ©/Ø§Ù„Ø´Ø±Ù‚ÙŠØ©
    convertToIndicNumbers: function(input) {
      const arabicToIndicMap = {
        "0": "Ù ",
        "1": "Ù¡",
        "2": "Ù¢",
        "3": "Ù£",
        "4": "Ù¤",
        "5": "Ù¥",
        "6": "Ù¦",
        "7": "Ù§",
        "8": "Ù¨",
        "9": "Ù©"
      };
      return input.replace(/[0-9]/g, (digit) => arabicToIndicMap[digit]);
    },
    
    // Ø¯Ø§Ù„Ø© Ù„Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø¬Ø¯Ø§ÙˆÙ„ ÙˆÙÙ‚ Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨
    processTable: function(table, manualModel) {
      try {
        const rows = table.querySelectorAll("tr");
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ ØµÙÙˆÙ ÙƒØ§ÙÙŠØ©
        if (rows.length < 3) {
          return null; // Ù„Ø§ ØªØªÙˆØ§ÙÙ‚ Ø¨Ù†ÙŠØ© Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù…Ø¹ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬
        }
        
        let modelUsed = manualModel;
        
        // ÙÙŠ Ø­Ø§Ù„Ø© Ø§Ø®ØªÙŠØ§Ø± Ø§Ù„ÙƒØ´Ù Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠ
        if (manualModel === "auto") {
          if (rows.length >= 4) {
            modelUsed = "withTitle";
          } else if (rows.length === 3) {
            const firstRowCells = rows[0].querySelectorAll("td");
            modelUsed = (firstRowCells.length >= 2) ? "withNumber" : "noNumber";
          } else {
            return null; // Ù„Ø§ ØªØªÙˆØ§ÙÙ‚ Ø¨Ù†ÙŠØ© Ø§Ù„Ø¬Ø¯ÙˆÙ„ Ù…Ø¹ Ø§Ù„Ù†Ù…Ø§Ø°Ø¬
          }
        } else {
          // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø£Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø¹Ø¯Ø¯ Ø§Ù„Ù…Ø·Ù„ÙˆØ¨ Ù…Ù† Ø§Ù„ØµÙÙˆÙ Ù„ÙƒÙ„ Ù†Ù…ÙˆØ°Ø¬
          if (modelUsed === "withTitle" && rows.length < 4) return null;
          if ((modelUsed === "withNumber" || modelUsed === "noNumber") && rows.length < 3) return null;
        }
        
        const data = {
          question: { text: "", image: "" },
          options: [],
          correct: -1
        };
        
        if (modelUsed === "noNumber") {
          // Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ø¯ÙˆÙ† Ø±Ù‚Ù… Ù„Ù„Ø³Ø¤Ø§Ù„: Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„
          const questionCell = rows[0].querySelector("td");
          if (questionCell) {
            data.question.text = this.convertToIndicNumbers(questionCell.textContent.trim());
            const questionImage = questionCell.querySelector("img");
            if (questionImage) {
              data.question.image = questionImage.src;
            }
          }
          // Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ: Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø£Ø±Ø¨Ø¹Ø©
          const optionCells = rows[1].querySelectorAll("td");
          if (optionCells.length === 4) {
            optionCells.forEach((cell) => {
              const option = {
                text: this.convertToIndicNumbers(cell.textContent.trim()),
                image: ""
              };
              const img = cell.querySelector("img");
              if (img) option.image = img.src;
              data.options.push(option);
            });
          }
          // Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø«: Ø±Ù…Ø² Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©
          const correctCells = rows[2].querySelectorAll("td");
          correctCells.forEach((cell, index) => {
            if (cell.textContent.trim() === "*" || cell.textContent.trim() === "1") {
              data.correct = index;
            }
          });
          
        } else if (modelUsed === "withNumber") {
          // Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ù…Ø¹ Ø±Ù‚Ù… Ù„Ù„Ø³Ø¤Ø§Ù„: Ø§Ù„ØµÙ Ø§Ù„Ø£ÙˆÙ„ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø®Ù„ÙŠØªÙŠÙ†Ø› Ø§Ù„Ø«Ø§Ù†ÙŠØ© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„
          const questionCells = rows[0].querySelectorAll("td");
          if (questionCells.length >= 2) {
            const questionCell = questionCells[1];
            data.question.text = this.convertToIndicNumbers(questionCell.textContent.trim());
            const questionImage = questionCell.querySelector("img");
            if (questionImage) data.question.image = questionImage.src;
          }
          // Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ: Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª
          const optionCells = rows[1].querySelectorAll("td");
          if (optionCells.length === 4) {
            optionCells.forEach((cell) => {
              const option = {
                text: this.convertToIndicNumbers(cell.textContent.trim()),
                image: ""
              };
              const img = cell.querySelector("img");
              if (img) option.image = img.src;
              data.options.push(option);
            });
          }
          // Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø«: Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©
          const correctCells = rows[2].querySelectorAll("td");
          correctCells.forEach((cell, index) => {
            if (cell.textContent.trim() === "*" || cell.textContent.trim() === "1") {
              data.correct = index;
            }
          });
          
        } else if (modelUsed === "withTitle") {
          // Ø§Ù„Ù†Ù…ÙˆØ°Ø¬ Ù…Ø¹ Ø¹Ù†ÙˆØ§Ù†: Ù†ÙØªØ±Ø¶ Ø£Ù† Ø§Ù„Ø¬Ø¯ÙˆÙ„ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ 4 ØµÙÙˆÙØŒ Ù…Ø¹ ÙˆØ¬ÙˆØ¯ ØµÙ Ø£ÙˆÙ„ (Ø¹Ù†ÙˆØ§Ù†) Ù„Ø§ ÙŠØªØ¶Ù…Ù† Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ø³Ø¤Ø§Ù„
          const questionCells = rows[1].querySelectorAll("td"); // Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù†ÙŠ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø±Ù‚Ù… Ø§Ù„Ø³Ø¤Ø§Ù„ ÙˆØ§Ù„Ù†Øµ
          if (questionCells.length >= 2) {
            const questionCell = questionCells[1]; // Ø§Ù„Ø®Ù„ÙŠØ© Ø§Ù„Ø«Ø§Ù†ÙŠØ© ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„
            data.question.text = this.convertToIndicNumbers(questionCell.textContent.trim());
            const questionImage = questionCell.querySelector("img");
            if (questionImage) data.question.image = questionImage.src;
          }
          // Ø§Ù„ØµÙ Ø§Ù„Ø«Ø§Ù„Ø«: Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª Ø§Ù„Ø£Ø±Ø¨Ø¹Ø©
          const optionCells = rows[2].querySelectorAll("td");
          if (optionCells.length === 4) {
            optionCells.forEach((cell) => {
              const option = {
                text: this.convertToIndicNumbers(cell.textContent.trim()),
                image: ""
              };
              const img = cell.querySelector("img");
              if (img) option.image = img.src;
              data.options.push(option);
            });
          }
          // Ø§Ù„ØµÙ Ø§Ù„Ø±Ø§Ø¨Ø¹: Ø±Ù…Ø² Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©
          const correctCells = rows[3].querySelectorAll("td");
          correctCells.forEach((cell, index) => {
            if (cell.textContent.trim() === "*" || cell.textContent.trim() === "1") {
              data.correct = index;
            }
          });
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµØ­Ø© Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ø§Ù„Ù…Ø³ØªØ®Ø±Ø¬Ø©
        if (!data.question.text || data.options.length !== 4 || data.correct === -1) {
          return null; // Ø¨ÙŠØ§Ù†Ø§Øª ØºÙŠØ± Ù…ÙƒØªÙ…Ù„Ø©
        }
        
        return data;
      } catch (error) {
        console.error("Error processing table:", error);
        return null;
      }
    },
    
    // Ø¯Ø§Ù„Ø© Ù„ØªØ­Ù…ÙŠÙ„ Ù…Ù„Ù JSON
    downloadJSON: function() {
      if (!this.currentData) {
        this.showError('Ù„Ø§ ÙŠÙˆØ¬Ø¯ Ø¨ÙŠØ§Ù†Ø§Øª JSON Ù„Ù„ØªÙ†Ø²ÙŠÙ„.');
        return;
      }
      
      try {
        const blob = new Blob([this.currentData], { type: "application/json" });
        const url = URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = "quiz.json";
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
        
        this.showSuccess('ØªÙ… ØªÙ†Ø²ÙŠÙ„ Ù…Ù„Ù JSON Ø¨Ù†Ø¬Ø§Ø­.');
      } catch (error) {
        console.error("Download error:", error);
        this.showError('Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ù…Ù„Ù: ' + error.message);
      }
    },
    
    // Ø¯Ø§Ù„Ø© Ù„Ø¥Ù†Ø´Ø§Ø¡ Ù…Ø¹Ø§ÙŠÙ†Ø© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
    createPreview: function(quiz) {
      const previewContainer = document.getElementById('previewContainer');
      previewContainer.innerHTML = '';
      
      if (quiz.length === 0) {
        previewContainer.innerHTML = '<div class="error-message">Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© Ù„Ù„Ø¹Ø±Ø¶.</div>';
        return;
      }
      
      quiz.forEach((question, index) => {
        const questionCard = document.createElement('div');
        questionCard.className = 'question-card';
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ø³Ø¤Ø§Ù„
        const questionNumber = document.createElement('h3');
        questionNumber.textContent = `Ø§Ù„Ø³Ø¤Ø§Ù„ ${this.convertToIndicNumbers((index + 1).toString())}:`;
        questionCard.appendChild(questionNumber);
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„
        const questionText = document.createElement('div');
        questionText.className = 'question-text';
        questionText.textContent = question.question.text;
        questionCard.appendChild(questionText);
        
        // Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø© Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¥Ø°Ø§ ÙˆØ¬Ø¯Øª
        if (question.question.image) {
          const questionImage = document.createElement('img');
          questionImage.className = 'question-image';
          questionImage.src = question.question.image;
          questionImage.alt = 'ØµÙˆØ±Ø© Ø§Ù„Ø³Ø¤Ø§Ù„';
          questionCard.appendChild(questionImage);
        }
        
        // Ø¥Ù†Ø´Ø§Ø¡ Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª
        const optionsList = document.createElement('ul');
        optionsList.className = 'options-list';
        
        // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª
        question.options.forEach((option, optIndex) => {
          const optionItem = document.createElement('li');
          optionItem.className = 'option-item';
          
          // ØªÙ…ÙŠÙŠØ² Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø©
          if (optIndex === question.correct) {
            optionItem.classList.add('correct');
          }
          
          // Ø¥Ø¶Ø§ÙØ© Ù†Øµ Ø§Ù„Ø®ÙŠØ§Ø±
          const optionText = document.createElement('div');
          optionText.textContent = `${String.fromCharCode(1632 + optIndex)}. ${option.text}`;
          optionItem.appendChild(optionText);
          
          // Ø¥Ø¶Ø§ÙØ© ØµÙˆØ±Ø© Ø§Ù„Ø®ÙŠØ§Ø± Ø¥Ø°Ø§ ÙˆØ¬Ø¯Øª
          if (option.image) {
            const optionImage = document.createElement('img');
            optionImage.className = 'option-image';
            optionImage.src = option.image;
            optionImage.alt = 'ØµÙˆØ±Ø© Ø§Ù„Ø®ÙŠØ§Ø±';
            optionItem.appendChild(optionImage);
          }
          
          optionsList.appendChild(optionItem);
        });
        
        questionCard.appendChild(optionsList);
        previewContainer.appendChild(questionCard);
      });
    },
    
    // Ø¯Ø§Ù„Ø© Ù„ØªØ¨Ø¯ÙŠÙ„ Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„ØªØ¨ÙˆÙŠØ¨
    showTab: function(tabName) {
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø²Ø± Ø§Ù„Ù†Ø´Ø·
      document.querySelectorAll('.tab-btn').forEach(btn => {
        btn.classList.remove('active');
      });
      document.getElementById(tabName + 'Tab').classList.add('active');
      
      // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù†Ø´Ø·
      document.querySelectorAll('.tab-content').forEach(content => {
        content.classList.remove('active');
      });
      document.getElementById(tabName + 'Output').classList.add('active');
      
      this.activeTab = tabName;
    },
    
    // Ø¯Ø§Ù„Ø© Ù„Ø¥Ø¹Ø§Ø¯Ø© ØªØ¹ÙŠÙŠÙ† ÙˆØ§Ø¬Ù‡Ø© Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…
    resetUI: function() {
      document.getElementById('output').textContent = '// Ø³ÙŠØªÙ… Ø¹Ø±Ø¶ JSON Ù‡Ù†Ø§';
      document.getElementById('questionCount').textContent = 'Ù„Ù… ÙŠØªÙ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø£Ø³Ø¦Ù„Ø© Ø¨Ø¹Ø¯.';
      document.getElementById('previewContainer').innerHTML = '';
      document.getElementById('downloadBtn').disabled = true;
      
      // Ø¥Ø²Ø§Ù„Ø© Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø®Ø·Ø£ ÙˆØ§Ù„Ù†Ø¬Ø§Ø­
      document.querySelectorAll('.error-message, .success-message, .warning-message').forEach(el => {
        el.remove();
      });
      
      this.currentData = null;
    },
    
    // Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø®Ø·Ø£
    showError: function(message) {
      this.showMessage(message, 'error');
    },
    
    // Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ù†Ø¬Ø§Ø­
    showSuccess: function(message) {
      this.showMessage(message, 'success');
    },
    
    // Ø¯Ø§Ù„Ø© Ù„Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© ØªØ­Ø°ÙŠØ±
    showWarning: function(message) {
      this.showMessage(message, 'warning');
    },
    
    // Ø¯Ø§Ù„Ø© Ø¹Ø§Ù…Ø© Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„
    showMessage: function(message, type) {
      // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø±Ø³Ø§Ø¦Ù„ Ø§Ù„Ø³Ø§Ø¨Ù‚Ø© Ù…Ù† Ù†ÙØ³ Ø§Ù„Ù†ÙˆØ¹
      document.querySelectorAll(`.${type}-message`).forEach(el => {
        el.remove();
      });
      
      const messageElement = document.createElement('div');
      messageElement.className = `${type}-message`;
      messageElement.textContent = message;
      
      // Ø¥Ø¶Ø§ÙØ© Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ù‚Ø¨Ù„ Ø´Ø±ÙŠØ· Ø§Ù„ØªÙ‚Ø¯Ù…
      const progressContainer = document.getElementById('progressContainer');
      progressContainer.parentNode.insertBefore(messageElement, progressContainer);
      
      // Ø¥Ø²Ø§Ù„Ø© Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†Ù
      if (type === 'success') {
        setTimeout(() => {
          messageElement.remove();
        }, 5000);
      }
    },
    
    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø£Ø®Ø·Ø§Ø¡ Ø§Ù„Ø¹Ø§Ù…Ø©
    handleGlobalError: function(event) {
      console.error('Global error:', event.error);
      this.showError('Ø­Ø¯Ø« Ø®Ø·Ø£ ØºÙŠØ± Ù…ØªÙˆÙ‚Ø¹: ' + (event.error ? event.error.message : 'Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ'));
      return false;
    }
  };

  // ØªÙ‡ÙŠØ¦Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¹Ù†Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
  document.addEventListener('DOMContentLoaded', function() {
    wordToJsonConverter.init();
  });
  </script>
</body>
</html>
