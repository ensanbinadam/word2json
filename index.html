<!DOCTYPE html>
<html dir="rtl" lang="ar">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ØªÙØ§Ø¹Ù„ÙŠØ© ØªØ¹Ù„ÙŠÙ…ÙŠØ©</title>
<!-- Ø¥Ø¶Ø§ÙØ© Ù…ÙƒØªØ¨Ø© KaTeX Ù„Ø¯Ø¹Ù… Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ© -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css">
<script src="https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js"></script>
<style>
        /* Ø£Ù†Ù…Ø§Ø· Ø§Ù„ØªØµÙ…ÙŠÙ… (ØªÙ… ØªØ­Ø³ÙŠÙ†Ù‡Ø§) */
        @import url('https://fonts.googleapis.com/css2?family=Tajawal:wght@300;500;700&display=swap');

        * {
            box-sizing: border-box;
            font-family: 'Tajawal', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            min-height: 100vh;
            margin: 0;
            padding: 20px;
            color: white;
        }

        .container {
            max-width: 800px;
            margin: 20px auto;
            opacity: 0;
            transform: translateY(20px);
            animation: fadeIn 0.5s ease-out forwards;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
        }

        .quiz-box {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            color: #333;
            position: relative;
         
        }

        .question {
            font-size: 1.4em;
            margin-bottom: 25px;
            font-weight: 700;
            line-height: 1.4;
        }

        .options {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 15px;
        }

         .option {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            border: 2px solid transparent;
            width: 100%; 
            min-height: 200px; /* Ø§Ø±ØªÙØ§Ø¹ Ø£Ø¯Ù†Ù‰ */
            overflow: hidden;
            text-align: center; /* Ù…Ø­Ø§Ø°Ø§Ø© Ø§Ù„Ù†Øµ Ù„Ù„ÙˆØ³Ø· */
            display: flex;
            align-items: center;
            justify-content: center
        }

        .option:hover {
            transform: translateX(10px);
            background: #e9ecef;
        }

        .option.correct {
            background: #28a745 !important;
            color: white !important;
        }

        .option.wrong {
            background: #dc3545 !important;
            color: white !important;
        }

        .controls {
            display: flex;
            gap: 10px;
            justify-content: space-between;
            margin-top: 20px;
        }

        .nav-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 25px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .nav-btn:disabled {
            background: #6c757d;
            cursor: not-allowed;
        }

        .pause-btn {
            background: #ffc107;
            color: black;
        }

        .progress-bar {
            height: 8px;
            background: #dee2e6;
            border-radius: 4px;
            margin: 20px 0;
            overflow: hidden;
        }

        .progress {
            height: 100%;
            background: #4CAF50;
            width: 0;
            transition: width 0.3s ease;
        }

        .score-board {
            text-align: center;
            font-size: 1.5em;
            display: none;
        }

        .restart-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1em;
            margin: 20px auto;
            display: block;
            transition: transform 0.3s ease;
        }

        .config-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 25px;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.3);
            display: none;
            color: #333;
            z-index: 1000;
            width: 90%;
            max-width: 500px;
        }

        .reading-text {
            background: rgba(255, 255, 255, 0.85);
            color: #1e3c72;
            padding: 20px;
            border-radius: 12px;
            margin-bottom: 20px;
            font-size: 1.2em;
            line-height: 1.7;
            font-weight: 500;
        }

        .config-btn {
            position: fixed;
            top: 20px;
            left: 20px;
            background: white;
            border: none;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            cursor: pointer;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.2);
            display: flex;
            align-items: center;
            justify-content: center;
        }

        @keyframes fadeIn {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }

            .quiz-box {
                padding: 20px;
            }

            .question {
                font-size: 1.2em;
            }

            .option {
                padding: 12px 20px;
            }
            
            .options {
                grid-template-columns: 1fr;
            }
        }

        .question-image {
            max-width: 100%;
            height: auto;
            margin: 15px 0;
            border-radius: 8px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        .counters {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin: -15px 0 25px 0;
            padding: 15px;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 10px;
            font-weight: 500;
            color: #2a5298;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            font-size: 1.1em;
            gap: 10px;
        }

        #timer {
            flex: 1;
            text-align: center;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.9);
            padding: 8px 20px;
            border-radius: 30px;
            font-weight: 700;
        }

        #questionCounter::before {
            content: "ğŸ“Œ ";
            margin-left: 5px;
        }

        #scoreCounter::before {
            content: "ğŸ† ";
            margin-left: 5px;
        }

        #timer::before {
            content: "â³";
            font-size: 1.3em;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% {
                transform: scale(1);
            }

            50% {
                transform: scale(1.1);
            }

            100% {
                transform: scale(1);
            }
        }

        @media (max-width: 768px) {
            .counters {
                flex-direction: column;
                align-items: stretch;
            }

            #timer {
                order: 2;
                margin: 10px 0;
            }
        }

        #scoreBoard h2 {
            direction: ltr;
            display: inline-block;
        }

        .question-content {
            display: flex;
            flex-direction: column;
            gap: 15px;
            margin-bottom: 20px;
        }

        .question-content img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin: 10px 0;
        }

        .option-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 10px;
            width: 100%;
        }
        
        .option-content img {
            width: 200px;
            height: 150px;
            object-fit: contain;
            background: #fff; /* Ø®Ù„ÙÙŠØ© Ø¨ÙŠØ¶Ø§Ø¡ Ù„Ù„ØµÙˆØ± Ø§Ù„ØµØºÙŠØ±Ø© */
            border-radius: 5px;
            margin: 0 auto;
            display: block;
        }

        .option-text {
            text-align: center; /* ØªÙˆØ³ÙŠØ· Ø§Ù„Ù†Øµ */
            padding: 5px;
            width: 100%;
            font-size: 18px; /* Ø­Ø¬Ù… Ø§Ù„Ø®Ø· */
            font-weight: bold; /* Ø¹Ø±ÙŠØ¶ Ù„Ø¬Ø¹Ù„ Ø§Ù„Ù†Øµ Ø¨Ø§Ø±Ø²Ù‹Ø§ */
        }

        /* Ø£Ù†Ù…Ø§Ø· Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ© */
        .math-container {
            display: inline-block;
            margin: 5px 0;
            padding: 5px;
            background-color: rgba(255, 255, 255, 0.8);
            border-radius: 5px;
        }

        .katex-display {
            margin: 0.5em 0;
            overflow-x: auto;
            overflow-y: hidden;
            padding: 5px;
        }

        /* ØªØ­Ø³ÙŠÙ† Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª ÙÙŠ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª */
        .option .katex {
            font-size: 1.2em;
        }

        .option .katex-display {
            margin: 0;
        }

        /* ØªØ­Ø³ÙŠÙ† Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª ÙÙŠ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© */
        .question .katex {
            font-size: 1.3em;
        }
        
        /* ØªØ­Ø³ÙŠÙ† Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø¹Ù„Ù‰ Ø§Ù„Ø£Ø¬Ù‡Ø²Ø© Ø§Ù„Ù…Ø­Ù…ÙˆÙ„Ø© */
        @media (max-width: 768px) {
            .katex-display {
                font-size: 0.9em;
                overflow-x: scroll;
            }
            
            .option .katex {
                font-size: 1em;
            }
        }
        
        /* Ø£Ù†Ù…Ø§Ø· Ù„Ù„Ø£Ø²Ø±Ø§Ø± Ø§Ù„Ø¥Ø¶Ø§ÙÙŠØ© */
        .action-btn {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin: 10px auto;
            display: block;
            font-size: 1em;
        }
        
        .action-btn:hover {
            background: #0056b3;
            transform: translateY(-2px);
        }
        
        .action-btn.sample {
            background: #28a745;
        }
        
        .action-btn.sample:hover {
            background: #218838;
        }

        /* Ø£Ù†Ù…Ø§Ø· Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø±Ø¶ */
        .settings-panel {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 20px;
            color: #333;
        }

        .settings-title {
            font-size: 1.2em;
            margin-bottom: 15px;
            color: #2a5298;
            font-weight: bold;
        }

        .settings-option {
            margin-bottom: 10px;
        }

        .settings-option label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .settings-option select, .settings-option input {
            width: 100%;
            padding: 8px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
    </style>
</head>
<body>
<button class="config-btn" onclick="toggleConfigPanel()">âš™ï¸</button>
<div class="container">
<div class="header">
<h1 id="quizTitle">ÙƒÙˆÙŠØ² Ø§Ù„Ø«Ù‚Ø§ÙØ© Ø§Ù„Ø¹Ø§Ù…Ø© ğŸ‡¸ğŸ‡¦</h1>
<p id="instructions">Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ù„ÙƒÙ„ Ø³Ø¤Ø§Ù„ Ù‚Ø¨Ù„ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ÙˆÙ‚Øª</p>
</div>

<!-- Ù„ÙˆØ­Ø© Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª -->
<div class="settings-panel" id="settingsPanel">
    <div class="settings-title">Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø¹Ø±Ø¶</div>
    <div class="settings-option">
        <label for="numeralType">Ù†ÙˆØ¹ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…:</label>
        <select id="numeralType" onchange="changeNumeralType()">
            <option value="arabic">Ø£Ø±Ù‚Ø§Ù… Ø¹Ø±Ø¨ÙŠØ© (1, 2, 3)</option>
            <option value="eastern" selected>Ø£Ø±Ù‚Ø§Ù… Ù‡Ù†Ø¯ÙŠØ© Ø´Ø±Ù‚ Ø£ÙˆØ³Ø·ÙŠØ© (Ù¡, Ù¢, Ù£)</option>
        </select>
    </div>
    <div class="settings-option">
        <label for="questionTime">ÙˆÙ‚Øª Ø§Ù„Ø³Ø¤Ø§Ù„ (Ø¨Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ):</label>
        <input type="number" id="questionTime" min="5" max="120" value="30" onchange="changeQuestionTime()">
    </div>
</div>

<div class="counters" id="countersBox">
<div id="questionCounter">ğŸ“Œ Ø§Ù„Ø³Ø¤Ø§Ù„ Ù  Ù…Ù† Ù </div>
<div id="timer">â³ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: Ù  Ø«Ø§Ù†ÙŠØ©</div>
<div id="scoreCounter">ğŸ† Ø§Ù„Ø¯Ø±Ø¬Ø§Øª: Ù  Ù…Ù† Ù </div>
</div>
<!-- Ø§Ù„Ù†Øµ Ø§Ù„Ù‚Ø±Ø§Ø¦ÙŠ ÙÙŠ Ù…ÙƒØ§Ù† Ù…Ø³ØªÙ‚Ù„ -->
<div class="reading-text" id="readingText"></div>
<div class="quiz-box"><div class="question" id="question"></div><div class="options" id="options"></div><div class="controls">
<button class="nav-btn" disabled="" id="prevBtn" onclick="previousQuestion()">Ø§Ù„Ø³Ø§Ø¨Ù‚</button>
<button class="nav-btn pause-btn" id="pauseBtn" onclick="togglePause()">ØªÙˆÙ‚Ù</button>
<button class="nav-btn" disabled="" id="nextBtn" onclick="nextQuestion()">Ø§Ù„ØªØ§Ù„ÙŠ</button>
</div><div class="progress-bar">
<div class="progress" id="progress"></div>
</div></div>
</div>
<div class="score-board" id="scoreBoard">
<h2>Ù†ØªÙŠØ¬ØªÙƒ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠØ©: <span id="totalQuestions">Ù </span>/<span id="finalScore">Ù </span></h2>
<button class="restart-btn" onclick="restartQuiz()">Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</button>
</div>
<div class="config-panel" id="configPanel">
<h3>Ù„ÙˆØ­Ø© Ø§Ù„ØªØ­ÙƒÙ…</h3>
<label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒÙˆÙŠØ²:</label>
<input class="form-control" id="titleInput" type="text"/>
<div> <label style="margin-top: 15px;">Ø§Ù„ØªÙˆØ¬ÙŠÙ‡Ø§Øª:</label>
<textarea class="form-control" id="instructionsInput" rows="5"></textarea>
</div>
<div style="margin-top: 20px; text-align: left;">
<button class="nav-btn" onclick="saveConfig()">Ø­ÙØ¸ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª</button>
<button class="nav-btn" onclick="toggleConfigPanel()">Ø¥Ù„ØºØ§Ø¡</button>
</div>
</div>
<script>
/**
 * ÙˆØ­Ø¯Ø© Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ© Ø§Ù„Ù…ÙˆØ­Ø¯Ø© Ø§Ù„Ù…Ø­Ø³Ù†Ø©
 * ØªØ¯Ø¹Ù… ØªØ­ÙˆÙŠÙ„ ÙˆØ¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ© Ù…Ù† Ù…Ø®ØªÙ„Ù Ø§Ù„ØµÙŠØº (LaTeX, MathML, OMML)
 * Ù…Ø¹ Ø¯Ø¹Ù… Ù…Ø­Ø³Ù† Ù„Ù„ÙƒØ´Ù Ø¹Ù† Ù…Ø¹Ø§Ø¯Ù„Ø§Øª LaTeX Ø¨Ø¯ÙˆÙ† Ø¹Ù„Ø§Ù…Ø§Øª Ù…Ø­Ø¯Ø¯Ø©
 */
class UnifiedEquationRenderer {
    constructor() {
        // Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© KaTeX
        this.checkKaTeXLoaded();
        
        // Ø£Ù†Ù…Ø§Ø· Ø§Ù„ØµÙŠØº Ø§Ù„Ù…Ø®ØªÙ„ÙØ© Ù„Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ©
        this.patterns = {
            // Ø£Ù†Ù…Ø§Ø· LaTeX Ù…Ø¹ Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
            latexWithDelimiters: /\\[a-zA-Z]+|\\[^a-zA-Z]|\$\$?.+?\$\$?|\\\[.+?\\\]|\\\(.+?\\\)/,
            // Ø£Ù†Ù…Ø§Ø· LaTeX Ø¨Ø¯ÙˆÙ† Ø¹Ù„Ø§Ù…Ø§Øª Ù…Ø­Ø¯Ø¯Ø© - ØªØ­Ø³ÙŠÙ† Ù„Ù„ÙƒØ´Ù Ø¹Ù† Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Word
            latexWithoutDelimiters: /\\frac\{.+?\}\{.+?\}|\\sqrt\{.+?\}|\\sum_\{.+?\}|\\\w+\{.+?\}|\\[a-zA-Z]+/,
            mathml: /<(?:math|m:math)[\s>]/i,
            omml: /<m:oMath|<oMath/i
        };
        
        // Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø© ÙÙŠ LaTeX
        this.latexKeywords = [
            '\\frac', '\\sqrt', '\\sum', '\\int', '\\prod', '\\lim', 
            '\\alpha', '\\beta', '\\gamma', '\\delta', '\\epsilon', '\\zeta', '\\eta', '\\theta',
            '\\iota', '\\kappa', '\\lambda', '\\mu', '\\nu', '\\xi', '\\pi', '\\rho', '\\sigma',
            '\\tau', '\\upsilon', '\\phi', '\\chi', '\\psi', '\\omega',
            '\\Gamma', '\\Delta', '\\Theta', '\\Lambda', '\\Xi', '\\Pi', '\\Sigma', '\\Upsilon',
            '\\Phi', '\\Psi', '\\Omega',
            '\\infty', '\\partial', '\\nabla', '\\times', '\\div', '\\cdot', '\\pm', '\\mp',
            '\\cup', '\\cap', '\\in', '\\notin', '\\subset', '\\supset', '\\emptyset',
            '\\mathbb', '\\mathcal', '\\mathfrak', '\\mathscr', '\\mathrm', '\\mathbf', '\\mathit',
            '\\sin', '\\cos', '\\tan', '\\cot', '\\sec', '\\csc', '\\arcsin', '\\arccos', '\\arctan',
            '\\sinh', '\\cosh', '\\tanh', '\\coth', '\\log', '\\ln', '\\exp',
            '\\rightarrow', '\\leftarrow', '\\Rightarrow', '\\Leftarrow', '\\leftrightarrow', '\\Leftrightarrow',
            '\\forall', '\\exists', '\\nexists', '\\therefore', '\\because'
        ];
    }

    /**
     * Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ù…ÙŠÙ„ Ù…ÙƒØªØ¨Ø© KaTeX
     */
    checkKaTeXLoaded() {
        if (typeof katex === 'undefined') {
            console.warn('Ù…ÙƒØªØ¨Ø© KaTeX ØºÙŠØ± Ù…Ø­Ù…Ù„Ø©. ÙŠØ±Ø¬Ù‰ ØªØ¶Ù…ÙŠÙ† Ù…ÙƒØªØ¨Ø© KaTeX ÙÙŠ Ø§Ù„ØµÙØ­Ø©.');
            
            // Ø¥Ø¶Ø§ÙØ© Ù…ÙƒØªØ¨Ø© KaTeX Ø¯ÙŠÙ†Ø§Ù…ÙŠÙƒÙŠØ§Ù‹ Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø©
            const link = document.createElement('link');
            link.rel = 'stylesheet';
            link.href = 'https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.css';
            document.head.appendChild(link);
            
            const script = document.createElement('script');
            script.src = 'https://cdn.jsdelivr.net/npm/katex@0.16.8/dist/katex.min.js';
            document.head.appendChild(script);
        }
    }

    /**
     * ØªØ­Ø¯ÙŠØ¯ Ù†ÙˆØ¹ ØµÙŠØºØ© Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ©
     * @param {string} input - Ù†Øµ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ©
     * @returns {string} - Ù†ÙˆØ¹ Ø§Ù„ØµÙŠØºØ© (latex, mathml, omml, unknown)
     */
    detectFormat(input) {
        if (!input || typeof input !== 'string') {
            return 'unknown';
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙŠØºØ© OMML Ø£ÙˆÙ„Ø§Ù‹
        if (this.patterns.omml.test(input)) {
            return 'omml';
        } 
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙŠØºØ© MathML
        if (this.patterns.mathml.test(input)) {
            return 'mathml';
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙŠØºØ© LaTeX Ù…Ø¹ Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
        if (this.patterns.latexWithDelimiters.test(input)) {
            return 'latex';
        }
        
        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ØµÙŠØºØ© LaTeX Ø¨Ø¯ÙˆÙ† Ø¹Ù„Ø§Ù…Ø§Øª Ù…Ø­Ø¯Ø¯Ø©
        if (this.patterns.latexWithoutDelimiters.test(input)) {
            return 'latex';
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† ÙˆØ¬ÙˆØ¯ ÙƒÙ„Ù…Ø§Øª Ù…ÙØªØ§Ø­ÙŠØ© LaTeX
        for (const keyword of this.latexKeywords) {
            if (input.includes(keyword)) {
                return 'latex';
            }
        }

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø£Ù†Ù…Ø§Ø· Ø¥Ø¶Ø§ÙÙŠØ© Ù„Ù„ÙƒØ³ÙˆØ± ÙˆØ§Ù„Ø¬Ø°ÙˆØ±
        if (/\\frac\{.*\}\{.*\}/.test(input) || /\\sqrt\{.*\}/.test(input)) {
            return 'latex';
        }

        return 'unknown';
    }

    /**
     * ØªØ­ÙˆÙŠÙ„ OMML Ø¥Ù„Ù‰ MathML
     * @param {string} omml - Ù†Øµ OMML
     * @returns {string} - Ù†Øµ MathML
     */
    convertOmmlToMathML(omml) {
        // Ù‡Ø°Ù‡ ÙˆØ¸ÙŠÙØ© Ù…Ø¨Ø³Ø·Ø© Ù„Ù„ØªØ­ÙˆÙŠÙ„
        // ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØŒ ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙƒØªØ¨Ø© Ù…Ø«Ù„ docx-math-converter
        
        // Ø¥Ø²Ø§Ù„Ø© Ù…Ø³Ø§Ø­Ø§Øª Ø§Ù„Ø£Ø³Ù…Ø§Ø¡ Ù…Ù† OMML Ù„ØªØ¨Ø³ÙŠØ· Ø§Ù„ØªØ­ÙˆÙŠÙ„
        let simplified = omml.replace(/m:/g, '');
        
        // ØªØ­ÙˆÙŠÙ„ Ø¨Ø¹Ø¶ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©
        simplified = simplified.replace(/<oMath>(.*?)<\/oMath>/g, '<math>$1</math>');
        simplified = simplified.replace(/<rad>(.*?)<\/rad>/g, '<msqrt>$1</msqrt>');
        simplified = simplified.replace(/<deg>(.*?)<\/deg>/g, '<mroot>$1</mroot>');
        simplified = simplified.replace(/<e>(.*?)<\/e>/g, '<mrow>$1</mrow>');
        simplified = simplified.replace(/<r>(.*?)<\/r>/g, '<mrow>$1</mrow>');
        simplified = simplified.replace(/<t>(.*?)<\/t>/g, '<mi>$1</mi>');
        simplified = simplified.replace(/<f>(.*?)<\/f>/g, '<mfrac>$1</mfrac>');
        simplified = simplified.replace(/<sSup>(.*?)<\/sSup>/g, '<msup>$1</msup>');
        
        return simplified;
    }

    /**
     * ØªØ­ÙˆÙŠÙ„ MathML Ø¥Ù„Ù‰ LaTeX
     * @param {string} mathml - Ù†Øµ MathML
     * @returns {string} - Ù†Øµ LaTeX
     */
    convertMathMLToLaTeX(mathml) {
        // Ù‡Ø°Ù‡ ÙˆØ¸ÙŠÙØ© Ù…Ø¨Ø³Ø·Ø© Ù„Ù„ØªØ­ÙˆÙŠÙ„
        // ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠØŒ ÙŠÙ…ÙƒÙ† Ø§Ø³ØªØ®Ø¯Ø§Ù… Ù…ÙƒØªØ¨Ø© Ù…Ø«Ù„ mathjax-node
        
        // ØªØ­ÙˆÙŠÙ„ Ø¨Ø¹Ø¶ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø´Ø§Ø¦Ø¹Ø©
        let latex = mathml;
        
        // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø¬Ø°Ø± Ø§Ù„ØªØ±Ø¨ÙŠØ¹ÙŠ
        latex = latex.replace(/<msqrt>(.*?)<\/msqrt>/g, '\\sqrt{$1}');
        
        // ØªØ­ÙˆÙŠÙ„ Ø§Ù„ÙƒØ³ÙˆØ±
        latex = latex.replace(/<mfrac><mrow>(.*?)<\/mrow><mrow>(.*?)<\/mrow><\/mfrac>/g, '\\frac{$1}{$2}');
        
        // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø³
        latex = latex.replace(/<msup><mi>(.*?)<\/mi><mn>(.*?)<\/mn><\/msup>/g, '$1^{$2}');
        
        // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…ØªØºÙŠØ±Ø§Øª
        latex = latex.replace(/<mi>(.*?)<\/mi>/g, '$1');
        
        // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…
        latex = latex.replace(/<mn>(.*?)<\/mn>/g, '$1');
        
        return latex;
    }

    /**
     * ØªØ­ÙˆÙŠÙ„ Ø£ÙŠ ØµÙŠØºØ© Ù…Ø¹Ø§Ø¯Ù„Ø© Ø¥Ù„Ù‰ LaTeX
     * @param {string} input - Ù†Øµ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ø¨Ø£ÙŠ ØµÙŠØºØ©
     * @returns {string} - Ù†Øµ LaTeX
     */
    convertToLaTeX(input) {
        const format = this.detectFormat(input);
        
        switch (format) {
            case 'latex':
                // Ø¥Ø¶Ø§ÙØ© Ø¹Ù„Ø§Ù…Ø§Øª Ù…Ø­Ø¯Ø¯Ø© Ø¥Ø°Ø§ Ù„Ù… ØªÙƒÙ† Ù…ÙˆØ¬ÙˆØ¯Ø©
                if (!input.startsWith('$') && !input.startsWith('\\(') && !input.startsWith('\\[')) {
                    return input; // Ù„Ø§ Ù†Ø¶ÙŠÙ Ø¹Ù„Ø§Ù…Ø§Øª Ù„Ø£Ù† KaTeX Ø³ÙŠØªØ¹Ø§Ù…Ù„ Ù…Ø¹Ù‡Ø§ Ù…Ø¨Ø§Ø´Ø±Ø©
                }
                return input;
            case 'mathml':
                return this.convertMathMLToLaTeX(input);
            case 'omml':
                const mathml = this.convertOmmlToMathML(input);
                return this.convertMathMLToLaTeX(mathml);
            default:
                // Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù†Øµ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙØŒ Ù†ÙØªØ±Ø¶ Ø£Ù†Ù‡ Ù†Øµ Ø¹Ø§Ø¯ÙŠ
                return input;
        }
    }

    /**
     * Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ© ÙÙŠ Ø¹Ù†ØµØ± HTML
     * @param {HTMLElement} element - Ø¹Ù†ØµØ± HTML Ù„Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© ÙÙŠÙ‡
     * @param {string} formula - Ù†Øµ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ø¨Ø£ÙŠ ØµÙŠØºØ©
     * @param {boolean} displayMode - ÙˆØ¶Ø¹ Ø§Ù„Ø¹Ø±Ø¶ (true Ù„Ù„Ø¹Ø±Ø¶ ÙƒÙ…Ø¹Ø§Ø¯Ù„Ø© Ù…Ø³ØªÙ‚Ù„Ø©ØŒ false Ù„Ù„Ø¹Ø±Ø¶ Ø¶Ù…Ù† Ø§Ù„Ù†Øµ)
     */
    renderEquation(element, formula, displayMode = false) {
        if (!element || !formula) {
            console.error('ÙŠØ¬Ø¨ ØªÙˆÙÙŠØ± Ø¹Ù†ØµØ± HTML ÙˆÙ†Øµ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø©');
            return;
        }

        try {
            // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ø¥Ù„Ù‰ LaTeX
            const latexFormula = this.convertToLaTeX(formula);
            
            // Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ø¨Ø§Ø³ØªØ®Ø¯Ø§Ù… KaTeX
            katex.render(latexFormula, element, {
                throwOnError: false,
                displayMode: displayMode
            });
        } catch (error) {
            console.error('Ø®Ø·Ø£ ÙÙŠ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ©:', error);
            element.textContent = formula;
        }
    }

    /**
     * Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø¬Ù…ÙŠØ¹ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª ÙÙŠ Ø§Ù„ØµÙØ­Ø© ÙˆØ¹Ø±Ø¶Ù‡Ø§
     * @param {string} selector - Ù…Ø­Ø¯Ø¯ CSS Ù„Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªÙŠ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…Ø¹Ø§Ø¯Ù„Ø§Øª
     */
    renderAllEquations(selector = '.math-container') {
        const elements = document.querySelectorAll(selector);
        
        elements.forEach(element => {
            const formula = element.textContent || element.innerHTML;
            const displayMode = element.dataset.display === 'block';
            
            // ØªÙØ±ÙŠØº Ø§Ù„Ø¹Ù†ØµØ± Ù‚Ø¨Ù„ Ø¹Ø±Ø¶ Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø©
            element.textContent = '';
            
            this.renderEquation(element, formula, displayMode);
        });
    }
}

// Ø¥Ù†Ø´Ø§Ø¡ ÙƒØ§Ø¦Ù† Ù…Ù† ÙˆØ­Ø¯Ø© Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø§Ù„Ù…ÙˆØ­Ø¯Ø©
let equationRenderer;

// Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØªØ­Ù…ÙŠÙ„ ÙˆØ­Ø¯Ø© Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø¨Ø¹Ø¯ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙØ­Ø©
document.addEventListener('DOMContentLoaded', function() {
    equationRenderer = new UnifiedEquationRenderer();
});

const quizConfig = {
    title: "Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª ØªÙØ§Ø¹Ù„ÙŠØ© ØªØ¹Ù„ÙŠÙ…ÙŠØ© ğŸ§®",
    instructions: "Ø§Ø®ØªØ± Ø§Ù„Ø¥Ø¬Ø§Ø¨Ø© Ø§Ù„ØµØ­ÙŠØ­Ø© Ù„ÙƒÙ„ Ø³Ø¤Ø§Ù„ Ù‚Ø¨Ù„ Ø§Ù†ØªÙ‡Ø§Ø¡ Ø§Ù„ÙˆÙ‚Øª"
};

const state = {
    currentQuestion: 0,
    score: 0,
    timeLeft: 30,
    timerId: null,
    isPaused: false,
    answeredQuestions: [],
    questions: [], // Ø³ÙŠØªÙ… ØªØ¹Ø¨Ø¦ØªÙ‡Ø§ Ù…Ù† Ù…Ù„Ù JSON
    numeralType: 'eastern', // Ù†ÙˆØ¹ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…: 'arabic' Ù„Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ø¹Ø±Ø¨ÙŠØ©ØŒ 'eastern' Ù„Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù‡Ù†Ø¯ÙŠØ© Ø§Ù„Ø´Ø±Ù‚ Ø£ÙˆØ³Ø·ÙŠØ©
    questionTime: 30 // ÙˆÙ‚Øª Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¨Ø§Ù„Ø«ÙˆØ§Ù†ÙŠ
};

function init() {
    if (!state.questions || state.questions.length === 0) {
        console.error("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© Ù…ØªØ§Ø­Ø©!");
        return;
    }

    state.answeredQuestions = new Array(state.questions.length).fill(false);
    showQuestion();
}

function showQuestion() {
    clearInterval(state.timerId);
    state.timeLeft = state.questionTime;
    updateTimerDisplay();

    const questionObj = state.questions[state.currentQuestion];

    // Ø¹Ø±Ø¶ Ø§Ù„Ù†Øµ Ø§Ù„Ù‚Ø±Ø§Ø¦ÙŠ Ø¥Ø°Ø§ ÙƒØ§Ù† Ù…ÙˆØ¬ÙˆØ¯Ù‹Ø§
    const readingDiv = document.getElementById('readingText');
    readingDiv.innerHTML = '';
    if (questionObj.paragraph || questionObj.paragraphImage || questionObj.paragraphMath) {
        if (questionObj.paragraph) {
            const paraText = document.createElement('div');
            paraText.textContent = questionObj.paragraph;
            readingDiv.appendChild(paraText);
        }
        if (questionObj.paragraphImage) {
            const paraImg = document.createElement('img');
            paraImg.src = questionObj.paragraphImage;
            paraImg.className = 'question-image';
            readingDiv.appendChild(paraImg);
        }
        // Ø¥Ø¶Ø§ÙØ© Ø¯Ø¹Ù… Ù„Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ© ÙÙŠ Ø§Ù„Ù†Øµ Ø§Ù„Ù‚Ø±Ø§Ø¦ÙŠ
        if (questionObj.paragraphMath) {
            const paraMath = document.createElement('div');
            paraMath.className = 'math-container';
            readingDiv.appendChild(paraMath);
            
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙˆØ­Ø¯Ø© Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø§Ù„Ù…ÙˆØ­Ø¯Ø©
            equationRenderer.renderEquation(paraMath, questionObj.paragraphMath, true);
        }
        readingDiv.style.display = 'block';
    } else {
        readingDiv.style.display = 'none';
    }

    if (!questionObj || !questionObj.question) {
        console.error("Ø§Ù„Ø³Ø¤Ø§Ù„ ØºÙŠØ± Ù…Ø¹Ø±Ù‘Ù Ø¨Ø´ÙƒÙ„ ØµØ­ÙŠØ­!");
        return;
    }

    const questionElement = document.getElementById('question');
    const optionsElement = document.getElementById('options');

    questionElement.innerHTML = '';
    const questionContent = document.createElement('div');
    questionContent.className = 'question-content';

    // Ø¹Ø±Ø¶ Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„
    if (questionObj.question.text) {
        const textElement = document.createElement('div');
        textElement.textContent = questionObj.question.text;
        questionContent.appendChild(textElement);
    }

    // Ø¹Ø±Ø¶ Ù…Ø¹Ø§Ø¯Ù„Ø© Ø±ÙŠØ§Ø¶ÙŠØ© ÙÙŠ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
    if (questionObj.question.math) {
        const mathElement = document.createElement('div');
        mathElement.className = 'math-container';
        questionContent.appendChild(mathElement);
        
        // Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙˆØ­Ø¯Ø© Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø§Ù„Ù…ÙˆØ­Ø¯Ø©
        equationRenderer.renderEquation(mathElement, questionObj.question.math, true);
    }

    // Ø¹Ø±Ø¶ ØµÙˆØ±Ø© Ø§Ù„Ø³Ø¤Ø§Ù„ Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
    if (questionObj.question.image) {
        const imgElement = document.createElement('img');
        imgElement.src = questionObj.question.image;
        imgElement.className = 'question-image';
        questionContent.appendChild(imgElement);
    }

    questionElement.appendChild(questionContent);

    optionsElement.innerHTML = '';
    if (!questionObj.options || questionObj.options.length === 0) {
        console.error("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø®ÙŠØ§Ø±Ø§Øª Ù…ØªØ§Ø­Ø© Ù„Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¤Ø§Ù„!");
        return;
    }

    questionObj.options.forEach((option, index) => {
        const optionElement = document.createElement('div');
        optionElement.className = 'option';

        const optionContent = document.createElement('div');
        optionContent.className = 'option-content';

        // Ø¹Ø±Ø¶ ØµÙˆØ±Ø© Ø§Ù„Ø®ÙŠØ§Ø± Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
        if (option.image) {
            const img = document.createElement('img');
            img.src = option.image;
            img.className = 'option-image';
            optionContent.appendChild(img);
        }

        // Ø¹Ø±Ø¶ Ù†Øµ Ø§Ù„Ø®ÙŠØ§Ø±
        if (option.text) {
            const text = document.createElement('span');
            text.className = 'option-text';
            
            // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù…Ø§ Ø¥Ø°Ø§ ÙƒØ§Ù† Ø§Ù„Ù†Øµ ÙŠØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ù…Ø¹Ø§Ø¯Ù„Ø© Ø±ÙŠØ§Ø¶ÙŠØ©
            if (option.text.includes('\\') || option.text.includes('$')) {
                const mathElement = document.createElement('div');
                mathElement.className = 'math-container';
                text.appendChild(mathElement);
                
                // Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙˆØ­Ø¯Ø© Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø§Ù„Ù…ÙˆØ­Ø¯Ø©
                equationRenderer.renderEquation(mathElement, option.text, false);
            } else {
                text.textContent = option.text;
            }
            
            optionContent.appendChild(text);
        }

        // Ø¹Ø±Ø¶ Ù…Ø¹Ø§Ø¯Ù„Ø© Ø±ÙŠØ§Ø¶ÙŠØ© ÙÙŠ Ø§Ù„Ø®ÙŠØ§Ø± Ø¥Ø°Ø§ ÙƒØ§Ù†Øª Ù…ÙˆØ¬ÙˆØ¯Ø©
        if (option.math) {
            const mathElement = document.createElement('div');
            mathElement.className = 'math-container';
            optionContent.appendChild(mathElement);
            
            // Ø§Ø³ØªØ®Ø¯Ø§Ù… ÙˆØ­Ø¯Ø© Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø§Ù„Ù…ÙˆØ­Ø¯Ø©
            equationRenderer.renderEquation(mathElement, option.math, false);
        }

        optionElement.appendChild(optionContent);
        optionsElement.appendChild(optionElement);

        if (state.answeredQuestions[state.currentQuestion]) {
            optionElement.style.pointerEvents = 'none';
            if (index === questionObj.correct) {
                optionElement.classList.add('correct');
            }
        }

        optionElement.onclick = () => {
            checkAnswer(index);
        };

        optionsElement.appendChild(optionElement);
    });

    document.getElementById('prevBtn').disabled = state.currentQuestion === 0;
    document.getElementById('nextBtn').disabled = false;

    document.getElementById('progress').style.width =
        `${(state.currentQuestion / state.questions.length) * 100}%`;

    updateQuestionCounter();
    updateScoreCounter();
    startTimer();
}

function startTimer() {
    state.timerId = setInterval(() => {
        if (!state.isPaused) {
            state.timeLeft--;
            updateTimerDisplay();
            if (state.timeLeft <= 0) {
                clearInterval(state.timerId);
                nextQuestion();
            }
        }
    }, 1000);
}

function updateTimerDisplay() {
    document.getElementById('timer').textContent =
        `Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${convertToSelectedNumerals(state.timeLeft)} Ø«Ø§Ù†ÙŠØ©`;
}

function checkAnswer(selectedIndex) {
    const options = document.querySelectorAll('.option');
    const correctIndex = state.questions[state.currentQuestion].correct;

    if (state.answeredQuestions[state.currentQuestion]) return;

    options.forEach(option => option.style.pointerEvents = 'none');

    options[correctIndex].classList.add('correct');

    if (selectedIndex === correctIndex) {
        state.score++;
        state.answeredQuestions[state.currentQuestion] = true;
        updateScoreCounter();
    } else {
        options[selectedIndex].classList.add('wrong');
    }

    if (state.currentQuestion < state.questions.length - 1) {
        setTimeout(() => {
            if (state.currentQuestion < state.questions.length - 1) {
                nextQuestion();
            } else {
                showResult();
            }
        }, 1500);
    } else {
        setTimeout(showResult, 1500);
    }
}

function nextQuestion() {
    if (state.currentQuestion >= state.questions.length - 1) {
        showResult();
        return;
    }
    if (state.currentQuestion < state.questions.length - 1) {
        state.currentQuestion++;
        showQuestion();
    } else {
        showResult();
    }
}

function previousQuestion() {
    if (state.currentQuestion > 0) {
        state.currentQuestion--;
        showQuestion();
    }
    document.getElementById('nextBtn').disabled = false;
}

function showResult() {
    const quizBox = document.querySelector('.quiz-box');
    const scoreBoard = document.getElementById('scoreBoard');

    if (quizBox && scoreBoard) {
        quizBox.style.display = 'none';
        scoreBoard.style.display = 'block';
        document.getElementById('loadButton').style.display = 'none';
        document.getElementById('readingText').style.display = 'none';
        document.getElementById('countersBox').style.display = 'none';
        document.getElementById('settingsPanel').style.display = 'none';
        document.getElementById('finalScore').textContent = convertToSelectedNumerals(state.score);
        document.getElementById('totalQuestions').textContent = convertToSelectedNumerals(state.questions.length);
    } else {
        console.error('Ø¹Ù†Ø§ØµØ± Ø§Ù„Ù†ØªÙŠØ¬Ø© ØºÙŠØ± Ù…ÙˆØ¬ÙˆØ¯Ø© ÙÙŠ Ø§Ù„ØµÙØ­Ø©');
    }
}

function restartQuiz() {
    state.currentQuestion = 0;
    state.score = 0;
    state.timeLeft = state.questionTime;
    state.answeredQuestions.fill(false);
    document.querySelector('.quiz-box').style.display = 'block';
    document.getElementById('scoreBoard').style.display = 'none';
    document.getElementById('loadButton').style.display = 'block';
    document.getElementById('settingsPanel').style.display = 'block';
    document.getElementById('countersBox').style.display = 'flex';
    document.getElementById('progress').style.width = '0%';
    document.querySelectorAll('.option').forEach(option => {
        option.classList.remove('correct', 'wrong');
        option.style.pointerEvents = 'auto';
        document.getElementById('countersBox').style.display = 'flex';
    });
    showQuestion();
}

function togglePause() {
    state.isPaused = !state.isPaused;
    const btn = document.getElementById('pauseBtn');
    btn.textContent = state.isPaused ? 'Ø§Ø³ØªØ¦Ù†Ø§Ù' : 'ØªÙˆÙ‚Ù';
    btn.style.background = state.isPaused ? '#28a745' : '#ffc107';
}

function toggleConfigPanel() {
    const panel = document.getElementById('configPanel');
    if (panel.style.display === 'block') {
        panel.style.display = 'none';
    } else {
        panel.style.display = 'block';
        document.getElementById('titleInput').value = quizConfig.title;
        document.getElementById('instructionsInput').value = quizConfig.instructions;
    }
}

function saveConfig() {
    const newTitle = document.getElementById('titleInput').value;
    const newInstructions = document.getElementById('instructionsInput').value;

    if (newTitle) {
        quizConfig.title = newTitle;
        document.getElementById('quizTitle').textContent = newTitle;
    }

    if (newInstructions) {
        quizConfig.instructions = newInstructions;
        document.getElementById('instructions').textContent = newInstructions;
    }

    toggleConfigPanel();
}

/**
 * ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø¥Ù„Ù‰ Ø§Ù„Ù†ÙˆØ¹ Ø§Ù„Ù…Ø­Ø¯Ø¯ (Ø¹Ø±Ø¨ÙŠØ© Ø£Ùˆ Ù‡Ù†Ø¯ÙŠØ© Ø´Ø±Ù‚ Ø£ÙˆØ³Ø·ÙŠØ©)
 * @param {number} num - Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø§Ø¯ ØªØ­ÙˆÙŠÙ„Ù‡
 * @returns {string} - Ø§Ù„Ø±Ù‚Ù… Ø¨Ø¹Ø¯ Ø§Ù„ØªØ­ÙˆÙŠÙ„
 */
function convertToSelectedNumerals(num) {
    if (num === undefined || num === null) {
        return state.numeralType === 'eastern' ? "Ù " : "0";
    }
    
    if (state.numeralType === 'eastern') {
        return toEasternArabicNumerals(num);
    } else {
        return num.toString();
    }
}

/**
 * ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø¥Ù„Ù‰ Ø£Ø±Ù‚Ø§Ù… Ù‡Ù†Ø¯ÙŠØ© Ø´Ø±Ù‚ Ø£ÙˆØ³Ø·ÙŠØ©
 * @param {number} num - Ø§Ù„Ø±Ù‚Ù… Ø§Ù„Ù…Ø±Ø§Ø¯ ØªØ­ÙˆÙŠÙ„Ù‡
 * @returns {string} - Ø§Ù„Ø±Ù‚Ù… Ø¨Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù‡Ù†Ø¯ÙŠØ© Ø§Ù„Ø´Ø±Ù‚ Ø£ÙˆØ³Ø·ÙŠØ©
 */
function toEasternArabicNumerals(num) {
    const easternArabicNumerals = ['Ù ', 'Ù¡', 'Ù¢', 'Ù£', 'Ù¤', 'Ù¥', 'Ù¦', 'Ù§', 'Ù¨', 'Ù©'];
    return num.toString().replace(/\d/g, digit => easternArabicNumerals[digit]);
}

/**
 * ØªØºÙŠÙŠØ± Ù†ÙˆØ¹ Ø§Ù„Ø£Ø±Ù‚Ø§Ù… Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù…Ø© ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
 */
function changeNumeralType() {
    const numeralType = document.getElementById('numeralType').value;
    state.numeralType = numeralType;
    
    // ØªØ­Ø¯ÙŠØ« Ø¬Ù…ÙŠØ¹ Ø§Ù„Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªÙŠ ØªØ­ØªÙˆÙŠ Ø¹Ù„Ù‰ Ø£Ø±Ù‚Ø§Ù…
    updateQuestionCounter();
    updateScoreCounter();
    updateTimerDisplay();
}

/**
 * ØªØºÙŠÙŠØ± ÙˆÙ‚Øª Ø§Ù„Ø³Ø¤Ø§Ù„
 */
function changeQuestionTime() {
    const questionTime = parseInt(document.getElementById('questionTime').value);
    if (questionTime >= 5 && questionTime <= 120) {
        state.questionTime = questionTime;
        state.timeLeft = questionTime;
        updateTimerDisplay();
    }
}

function updateQuestionCounter() {
    document.getElementById('questionCounter').textContent =
        `Ø§Ù„Ø³Ø¤Ø§Ù„ ${convertToSelectedNumerals(state.currentQuestion + 1)} Ù…Ù† ${convertToSelectedNumerals(state.questions.length)}`;
}

function updateScoreCounter() {
    document.getElementById('scoreCounter').textContent =
        `Ø§Ù„Ø¯Ø±Ø¬Ø§Øª: ${convertToSelectedNumerals(state.score)} Ù…Ù† ${convertToSelectedNumerals(state.questions.length)}`;
}

/**
 * ÙˆØ¸ÙŠÙØ© Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ© ÙÙŠ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ø­Ù…Ù„Ø©
 * ØªÙ… ØªØ­Ø³ÙŠÙ†Ù‡Ø§ Ù„Ù„ØªØ¹Ø±Ù Ø¹Ù„Ù‰ Ù…Ø¹Ø§Ø¯Ù„Ø§Øª LaTeX Ø¨Ø¯ÙˆÙ† Ø¹Ù„Ø§Ù…Ø§Øª Ù…Ø­Ø¯Ø¯Ø©
 * @param {Array} questions - Ù…ØµÙÙˆÙØ© Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
 */
function processEquationsInQuestions(questions) {
    if (!questions || !Array.isArray(questions)) return;
    
    // Ø£Ù†Ù…Ø§Ø· Ù„Ù„ÙƒØ´Ù Ø¹Ù† Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ© Ø¨Ù…Ø®ØªÙ„Ù Ø§Ù„ØµÙŠØº
    const mathPatterns = {
        // Ø£Ù†Ù…Ø§Ø· LaTeX Ù…Ø¹ Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
        latexWithDelimiters: /\\\(.+?\\\)|\\\[.+?\\\]|\$\$.+?\$\$|\$.+?\$/gs,
        // Ø£Ù†Ù…Ø§Ø· LaTeX Ø¨Ø¯ÙˆÙ† Ø¹Ù„Ø§Ù…Ø§Øª Ù…Ø­Ø¯Ø¯Ø© - ØªØ­Ø³ÙŠÙ† Ù„Ù„ÙƒØ´Ù Ø¹Ù† Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Word
        latexWithoutDelimiters: /\\frac\{.+?\}\{.+?\}|\\sqrt\{.+?\}|\\sum_\{.+?\}|\\\w+\{.+?\}/gs,
        // Ø£Ù†Ù…Ø§Ø· MathML Ùˆ OMML
        mathml: /<math.+?<\/math>/gs,
        omml: /<m:oMath.+?<\/m:oMath>|<oMath.+?<\/oMath>/gs
    };
    
    // Ù‚Ø§Ø¦Ù…Ø© Ø¨Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ© Ø§Ù„Ø´Ø§Ø¦Ø¹Ø© ÙÙŠ LaTeX
    const latexKeywords = [
        '\\frac', '\\sqrt', '\\sum', '\\int', '\\prod', '\\lim', 
        '\\alpha', '\\beta', '\\gamma', '\\delta', '\\epsilon', '\\zeta', '\\eta', '\\theta',
        '\\iota', '\\kappa', '\\lambda', '\\mu', '\\nu', '\\xi', '\\pi', '\\rho', '\\sigma',
        '\\tau', '\\upsilon', '\\phi', '\\chi', '\\psi', '\\omega'
    ];
    
    questions.forEach(question => {
        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª ÙÙŠ Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„
        if (question.question) {
            if (typeof question.question === 'string') {
                // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø³Ø¤Ø§Ù„ Ø§Ù„Ø¨Ø³ÙŠØ· Ø¥Ù„Ù‰ ÙƒØ§Ø¦Ù†
                const text = question.question;
                question.question = { text: text };
            }
            
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª ÙÙŠ Ù†Øµ Ø§Ù„Ø³Ø¤Ø§Ù„
            if (question.question.text) {
                // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø¨Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
                let matches = question.question.text.match(mathPatterns.latexWithDelimiters);
                
                // Ø¥Ø°Ø§ Ù„Ù… Ù†Ø¬Ø¯ Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø¨Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©ØŒ Ù†Ø¨Ø­Ø« Ø¹Ù† Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø¨Ø¯ÙˆÙ† Ø¹Ù„Ø§Ù…Ø§Øª
                if (!matches) {
                    matches = question.question.text.match(mathPatterns.latexWithoutDelimiters);
                }
                
                // Ø¥Ø°Ø§ Ù„Ù… Ù†Ø¬Ø¯ Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø¨Ø§Ù„Ø£Ù†Ù…Ø§Ø·ØŒ Ù†Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ©
                if (!matches) {
                    for (const keyword of latexKeywords) {
                        if (question.question.text.includes(keyword)) {
                            // Ø¥Ø°Ø§ ÙˆØ¬Ø¯Ù†Ø§ ÙƒÙ„Ù…Ø© Ù…ÙØªØ§Ø­ÙŠØ©ØŒ Ù†Ø¹ØªØ¨Ø± Ø§Ù„Ù†Øµ ÙƒÙ„Ù‡ Ù…Ø¹Ø§Ø¯Ù„Ø©
                            matches = [question.question.text];
                            break;
                        }
                    }
                }
                
                // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† MathML Ùˆ OMML
                if (!matches) {
                    matches = question.question.text.match(mathPatterns.mathml) || 
                              question.question.text.match(mathPatterns.omml);
                }
                
                if (matches && matches.length > 0) {
                    // Ø¥Ø°Ø§ ÙˆØ¬Ø¯Øª Ù…Ø¹Ø§Ø¯Ù„Ø©ØŒ Ø§Ù†Ù‚Ù„Ù‡Ø§ Ø¥Ù„Ù‰ Ø­Ù‚Ù„ math
                    question.question.math = matches[0];
                    // Ø§Ø­Ø°Ù Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ù…Ù† Ø§Ù„Ù†Øµ Ø§Ù„Ø£ØµÙ„ÙŠ
                    question.question.text = question.question.text.replace(matches[0], '').trim();
                }
            }
        }
        
        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª ÙÙŠ Ø§Ù„Ø®ÙŠØ§Ø±Ø§Øª
        if (question.options && Array.isArray(question.options)) {
            question.options.forEach((option, index) => {
                if (typeof option === 'string') {
                    // ØªØ­ÙˆÙŠÙ„ Ø§Ù„Ø®ÙŠØ§Ø± Ø§Ù„Ø¨Ø³ÙŠØ· Ø¥Ù„Ù‰ ÙƒØ§Ø¦Ù†
                    const text = option;
                    question.options[index] = { text: text };
                    option = question.options[index];
                }
                
                // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª ÙÙŠ Ù†Øµ Ø§Ù„Ø®ÙŠØ§Ø±
                if (option.text) {
                    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø¨Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
                    let matches = option.text.match(mathPatterns.latexWithDelimiters);
                    
                    // Ø¥Ø°Ø§ Ù„Ù… Ù†Ø¬Ø¯ Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø¨Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©ØŒ Ù†Ø¨Ø­Ø« Ø¹Ù† Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø¨Ø¯ÙˆÙ† Ø¹Ù„Ø§Ù…Ø§Øª
                    if (!matches) {
                        matches = option.text.match(mathPatterns.latexWithoutDelimiters);
                    }
                    
                    // Ø¥Ø°Ø§ Ù„Ù… Ù†Ø¬Ø¯ Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø¨Ø§Ù„Ø£Ù†Ù…Ø§Ø·ØŒ Ù†Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ©
                    if (!matches) {
                        for (const keyword of latexKeywords) {
                            if (option.text.includes(keyword)) {
                                // Ø¥Ø°Ø§ ÙˆØ¬Ø¯Ù†Ø§ ÙƒÙ„Ù…Ø© Ù…ÙØªØ§Ø­ÙŠØ©ØŒ Ù†Ø¹ØªØ¨Ø± Ø§Ù„Ù†Øµ ÙƒÙ„Ù‡ Ù…Ø¹Ø§Ø¯Ù„Ø©
                                matches = [option.text];
                                break;
                            }
                        }
                    }
                    
                    // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† MathML Ùˆ OMML
                    if (!matches) {
                        matches = option.text.match(mathPatterns.mathml) || 
                                  option.text.match(mathPatterns.omml);
                    }
                    
                    if (matches && matches.length > 0) {
                        // Ø¥Ø°Ø§ ÙˆØ¬Ø¯Øª Ù…Ø¹Ø§Ø¯Ù„Ø©ØŒ Ø§Ù†Ù‚Ù„Ù‡Ø§ Ø¥Ù„Ù‰ Ø­Ù‚Ù„ math
                        option.math = matches[0];
                        // Ø§Ø­Ø°Ù Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ù…Ù† Ø§Ù„Ù†Øµ Ø§Ù„Ø£ØµÙ„ÙŠ
                        option.text = option.text.replace(matches[0], '').trim();
                    }
                }
            });
        }
        
        // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª ÙÙŠ Ø§Ù„Ù†Øµ Ø§Ù„Ù‚Ø±Ø§Ø¦ÙŠ
        if (question.paragraph) {
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø¨Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
            let matches = question.paragraph.match(mathPatterns.latexWithDelimiters);
            
            // Ø¥Ø°Ø§ Ù„Ù… Ù†Ø¬Ø¯ Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø¨Ø§Ù„Ø¹Ù„Ø§Ù…Ø§Øª Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©ØŒ Ù†Ø¨Ø­Ø« Ø¹Ù† Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø¨Ø¯ÙˆÙ† Ø¹Ù„Ø§Ù…Ø§Øª
            if (!matches) {
                matches = question.paragraph.match(mathPatterns.latexWithoutDelimiters);
            }
            
            // Ø¥Ø°Ø§ Ù„Ù… Ù†Ø¬Ø¯ Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø¨Ø§Ù„Ø£Ù†Ù…Ø§Ø·ØŒ Ù†Ø¨Ø­Ø« Ø¹Ù† Ø§Ù„ÙƒÙ„Ù…Ø§Øª Ø§Ù„Ù…ÙØªØ§Ø­ÙŠØ©
            if (!matches) {
                for (const keyword of latexKeywords) {
                    if (question.paragraph.includes(keyword)) {
                        // Ø¥Ø°Ø§ ÙˆØ¬Ø¯Ù†Ø§ ÙƒÙ„Ù…Ø© Ù…ÙØªØ§Ø­ÙŠØ©ØŒ Ù†Ø¹ØªØ¨Ø± Ø§Ù„Ù†Øµ ÙƒÙ„Ù‡ Ù…Ø¹Ø§Ø¯Ù„Ø©
                        matches = [question.paragraph];
                        break;
                    }
                }
            }
            
            // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† MathML Ùˆ OMML
            if (!matches) {
                matches = question.paragraph.match(mathPatterns.mathml) || 
                          question.paragraph.match(mathPatterns.omml);
            }
            
            if (matches && matches.length > 0) {
                // Ø¥Ø°Ø§ ÙˆØ¬Ø¯Øª Ù…Ø¹Ø§Ø¯Ù„Ø©ØŒ Ø§Ù†Ù‚Ù„Ù‡Ø§ Ø¥Ù„Ù‰ Ø­Ù‚Ù„ paragraphMath
                question.paragraphMath = matches[0];
                // Ø§Ø­Ø°Ù Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø© Ù…Ù† Ø§Ù„Ù†Øµ Ø§Ù„Ø£ØµÙ„ÙŠ
                question.paragraph = question.paragraph.replace(matches[0], '').trim();
            }
        }
    });
}

/**
 * ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù…Ù† Ù…Ù„Ù
 */
function loadQuestionsFromFile() {
    const input = document.createElement('input');
    input.type = 'file';
    input.accept = '.json';
    input.onchange = function (e) {
        const file = e.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function (e) {
                try {
                    const loadedQuestions = JSON.parse(e.target.result);
                    
                    // Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ù…Ø¹Ø§Ø¯Ù„Ø§Øª Ø§Ù„Ø±ÙŠØ§Ø¶ÙŠØ© ÙÙŠ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ø§Ù„Ù…Ø­Ù…Ù„Ø©
                    processEquationsInQuestions(loadedQuestions);
                    
                    state.questions = loadedQuestions;
                    init();
                } catch (error) {
                    console.error("Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù„ÙŠÙ„ Ù…Ù„Ù JSON:", error);
                    alert("Ø­Ø¯Ø« Ø®Ø·Ø£ ÙÙŠ ØªØ­Ù„ÙŠÙ„ Ù…Ù„Ù Ø§Ù„Ø£Ø³Ø¦Ù„Ø©. ÙŠØ±Ø¬Ù‰ Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† ØµØ­Ø© ØªÙ†Ø³ÙŠÙ‚ Ø§Ù„Ù…Ù„Ù.");
                }
            };
            reader.readAsText(file);
        }
    };
    input.click();
}

/**
 * Ø­ÙØ¸ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙƒÙ…Ù„Ù JSON Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø­Ù„ÙŠ
 */
function saveQuestionsToFile() {
    if (!state.questions || state.questions.length === 0) {
        alert("Ù„Ø§ ØªÙˆØ¬Ø¯ Ø£Ø³Ø¦Ù„Ø© Ù„Ø­ÙØ¸Ù‡Ø§!");
        return;
    }
    
    const dataStr = JSON.stringify(state.questions, null, 2);
    const dataUri = 'data:application/json;charset=utf-8,'+ encodeURIComponent(dataStr);
    
    const exportFileDefaultName = 'quiz_questions.json';
    
    const linkElement = document.createElement('a');
    linkElement.setAttribute('href', dataUri);
    linkElement.setAttribute('download', exportFileDefaultName);
    linkElement.click();
}

/**
 * Ø­ÙØ¸ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ ÙƒØ§Ù…Ù„Ø§Ù‹ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø­Ù„ÙŠ
 */
function saveAppForOfflineUse() {
    // Ø¥Ù†Ø´Ø§Ø¡ Ø±Ø§Ø¨Ø· Ù„ØªÙ†Ø²ÙŠÙ„ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø­Ø§Ù„ÙŠØ©
    const htmlContent = document.documentElement.outerHTML;
    const blob = new Blob([htmlContent], {type: 'text/html'});
    const url = URL.createObjectURL(blob);
    
    const a = document.createElement('a');
    a.href = url;
    a.download = 'quiz_app_offline.html';
    a.click();
    
    // ØªØ­Ø±ÙŠØ± Ø§Ù„Ù…ÙˆØ§Ø±Ø¯
    setTimeout(() => {
        URL.revokeObjectURL(url);
    }, 100);
}

window.onload = () => {
    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ù†Øµ Ø§Ù„Ù‚Ø±Ø§Ø¦ÙŠ Ø¹Ù†Ø¯ ÙØªØ­ Ø§Ù„ØµÙØ­Ø©
    const readingText = document.getElementById('readingText');
    if (readingText) {
        readingText.style.display = 'none';
    }

    // Ø²Ø± ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
    const loadButton = document.createElement('button');
    loadButton.id = 'loadButton';
    loadButton.textContent = 'ØªØ­Ù…ÙŠÙ„ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© Ù…Ù† Ù…Ù„Ù';
    loadButton.className = 'action-btn';
    loadButton.style.margin = '10px auto';
    loadButton.style.display = 'block';
    loadButton.onclick = loadQuestionsFromFile;
    document.querySelector('.header').appendChild(loadButton);
    
    // Ø²Ø± Ø­ÙØ¸ Ø§Ù„Ø£Ø³Ø¦Ù„Ø©
    const saveQuestionsButton = document.createElement('button');
    saveQuestionsButton.id = 'saveQuestionsButton';
    saveQuestionsButton.textContent = 'Ø­ÙØ¸ Ø§Ù„Ø£Ø³Ø¦Ù„Ø© ÙƒÙ…Ù„Ù';
    saveQuestionsButton.className = 'action-btn';
    saveQuestionsButton.style.margin = '10px auto';
    saveQuestionsButton.style.display = 'block';
    saveQuestionsButton.onclick = saveQuestionsToFile;
    document.querySelector('.header').appendChild(saveQuestionsButton);
    
    // Ø²Ø± Ø­ÙØ¸ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø­Ù„ÙŠ
    const saveAppButton = document.createElement('button');
    saveAppButton.id = 'saveAppButton';
    saveAppButton.textContent = 'Ø­ÙØ¸ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ù„Ù„Ø§Ø³ØªØ®Ø¯Ø§Ù… Ø§Ù„Ù…Ø­Ù„ÙŠ';
    saveAppButton.className = 'action-btn';
    saveAppButton.style.margin = '10px auto';
    saveAppButton.style.display = 'block';
    saveAppButton.style.backgroundColor = '#6c757d';
    saveAppButton.onclick = saveAppForOfflineUse;
    document.querySelector('.header').appendChild(saveAppButton);

    // ØªØ­Ø¯ÙŠØ« Ø§Ù„Ø¹Ø¯Ø§Ø¯Ø§Øª Ø§Ù„Ø£ÙˆÙ„ÙŠØ©
    document.getElementById('questionCounter').innerHTML = `ğŸ“Œ Ø§Ù„Ø³Ø¤Ø§Ù„ ${convertToSelectedNumerals(0)} Ù…Ù† ${convertToSelectedNumerals(state.questions.length)}`;
    document.getElementById('timer').innerHTML = `â³ Ø§Ù„ÙˆÙ‚Øª Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: ${convertToSelectedNumerals(state.timeLeft)} Ø«Ø§Ù†ÙŠØ©`;
    document.getElementById('scoreCounter').innerHTML = `ğŸ† Ø§Ù„Ø¯Ø±Ø¬Ø§Øª: ${convertToSelectedNumerals(0)} Ù…Ù† ${convertToSelectedNumerals(state.questions.length)}`;
    document.getElementById('totalQuestions').textContent = convertToSelectedNumerals(state.questions.length);
    
    // ØªØ­Ø¯ÙŠØ« Ø¹Ù†ÙˆØ§Ù† Ø§Ù„ÙƒÙˆÙŠØ²
    document.getElementById('quizTitle').textContent = quizConfig.title;
    
    // ØªØ­Ø¯ÙŠØ« Ù‚ÙŠÙ… Ø§Ù„Ø¥Ø¹Ø¯Ø§Ø¯Ø§Øª
    document.getElementById('numeralType').value = state.numeralType;
    document.getElementById('questionTime').value = state.questionTime;
};
</script>
</body>
</html>
